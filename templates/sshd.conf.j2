#jinja2: trim_blocks: "true", lstrip_blocks: "true"
# Generated by Ansible role {{ ansible_role_name }}
# This is the sshd server system-wide 1configuration file.  See sshd_config(5) for more information.

##  Networking  ##

# Configure TCP listen port(s) sshd should listen on
{% for port in sshd_listen_ports %}
Port {{ port }}
{% endfor %}

# Configure AddressFamily sshd should listen on
AddressFamily {{ sshd_address_family }}

# Configure the IP address(es) sshd should listen on
{% for address in sshd_listen_addresses %}
ListenAddress {{ address }}
{% endfor %}

# Configure syslog facility identifier
SyslogFacility {{ sshd_syslog_facility }}

# Configure logging level
LogLevel {{ sshd_log_level }}

# Configure X11Forwarding
X11Forwarding {{ 'yes' if (ssh_x11_forwarding|bool) else 'no' }}
X11UseLocalhost yes


##  Authentication  ##

# Configure root login
PermitRootLogin {{ sshd_permit_root_login }}

# Configure login grace time before sshd auto-disconnects
LoginGraceTime {{ sshd_login_grace_time }}

# Configure max authentication retries per connection
MaxAuthTries {{ sshd_max_auth_retries }}

# Configure max sessions per connection
MaxSessions {{ sshd_max_sessions }}

# Configure the maximum concurrent non-authenticated connections
MaxStartups {{ sshd_max_startups }}

# Configure public key authentication
PubkeyAuthentication {{ sshd_allow_pubkey_auth }}

# Configure password authentication
PasswordAuthentication {{ sshd_allow_password_auth }}

{% if sshd_deny_users %}
# Configured denied user(s) pattern
DenyUsers {{ sshd_deny_users }}

{% endif %}
{% if sshd_allow_users %}
# Configured allowed user(s) pattern
AllowUsers {{ sshd_allow_users }}

{% endif %}
{% if sshd_deny_groups %}
# Configured denied group(s) pattern
DenyGroups {{ sshd_deny_groups }}

{% endif %}
{% if sshd_allow_groups %}
# Configured allowed group(s) pattern
AllowGroups {{ sshd_allow_groups }}

{% endif %}
# Disable host-based authentication
IgnoreRhosts yes
IgnoreUserKnownHosts yes
HostbasedAuthentication no

# Configure MOTD
PrintMotd {{ sshd_print_motd }}

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem sftp internal-sftp